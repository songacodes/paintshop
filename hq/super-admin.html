<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Grand Admin Panel</title>

  <!-- Tailwind CSS & Remix Icon -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
  <!-- SheetJS for Excel export/import -->
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

  <!-- Your custom stylesheet (kept) -->
  <link rel="stylesheet" href="style.css" />

  <!-- Smooth-scroll & active-link highlight -->
  <style>
    html{scroll-behavior:smooth;}
    /* highlight colour like a "current page" tab */
    .sidebar-active{
      font-weight:700;                 /* bold */
      color:#4338ca !important;        /* indigo-800 */
      background:#eef2ff;              /* indigo-100 */
      border-radius:0.25rem;           /* slight pill */
    }
  </style>
</head>

<body class="bg-gray-100 flex">

  <!-- Sidebar -->
  <aside class="w-56 min-w-56 h-screen fixed top-0 left-0 bg-white shadow flex flex-col justify-between p-4 z-10">
    <div>
      <h1 class="text-lg font-bold bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 text-transparent bg-clip-text mb-6" id="sidebar-superadmin-heading">Grand Admin</h1>
      <nav class="flex flex-col gap-3">
        <a href="#shops-section" class="sidebar-link flex items-center gap-2 text-indigo-700 hover:text-indigo-900 transition text-base"><i class="ri-git-branch-line"></i> Shops</a>
        <a href="#clients-section" class="sidebar-link flex items-center gap-2 text-indigo-700 hover:text-indigo-900 transition text-base"><i class="ri-user-3-line"></i> Clients</a>
        <a href="#excel-import-section" class="sidebar-link flex items-center gap-2 text-indigo-700 hover:text-indigo-900 transition text-base"><i class="ri-file-upload-line"></i> Import Clients</a>
        <a href="#transactions-section" class="sidebar-link flex items-center gap-2 text-indigo-700 hover:text-indigo-900 transition text-base"><i class="ri-file-list-3-line"></i> Transactions</a>
        <a href="#excel-export-section" class="sidebar-link flex items-center gap-2 text-indigo-700 hover:text-indigo-900 transition text-base"><i class="ri-file-excel-2-line"></i> Excel Reports</a>
        <a href="#users-section" class="sidebar-link flex items-center gap-2 text-indigo-700 hover:text-indigo-900 transition text-base"><i class="ri-group-line"></i> Users</a>
        <a href="#archive-section" id="archive-sidebar-link" class="sidebar-link flex items-center gap-2 text-indigo-700 hover:text-indigo-900 transition text-base"><i class="ri-archive-line"></i> Archive</a>
      </nav>
    </div>
    <button onclick="logout()" class="flex items-center text-red-600 hover:text-red-800 text-base py-2 px-3 rounded-md transition duration-200">
      <i class="ri-logout-box-line mr-2"></i> Logout
    </button>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 p-6 ml-56 min-w-0 overflow-x-auto"> <!-- Adjusted ml for fixed sidebar, min-w-0 for flex, overflow-x-auto for wide tables -->

    <!-- Shops Section -->
    <section id="shops-section" class="bg-white rounded-lg shadow-md p-6 mb-6">
      <h2 class="text-2xl font-semibold text-gray-800 mb-4 flex items-center"><i class="ri-git-branch-line mr-2"></i> Shop creation Form</h2>
      
      <!-- Add Shop Form -->
      <form id="branch-form-actual" class="grid grid-cols-1 md:grid-cols-2 gap-4 bg-gray-50 p-4 rounded-lg shadow-inner mb-6">
          <div>
              <label for="shop-name" class="block text-sm font-medium text-gray-700">Shop Name (Used for ID & Login)</label>
              <input type="text" id="shop-name" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2">
          </div>
          <div>
              <label for="shop-location" class="block text-sm font-medium text-gray-700">Shop Location</label>
              <input type="text" id="shop-location" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2">
          </div>
          <div>
              <label for="shop-user-password" class="block text-sm font-medium text-gray-700">Shop User Password (Username will be Shop Name)</label>
              <input type="password" id="shop-user-password" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2">
          </div>
          <div>
              <label for="shop-admin-username" class="block text-sm font-medium text-gray-700">Shop Admin Username (Shop Manager)</label>
              <input type="text" id="shop-admin-username" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2">
          </div>
          <div class="col-span-1 md:col-span-2">
              <label for="shop-admin-password" class="block text-sm font-medium text-gray-700">Shop Admin Password</label>
              <input type="password" id="shop-admin-password" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2">
          </div>
          <div class="col-span-1 md:col-span-2 text-right">
              <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                  Add Shop
              </button>
          </div>
      </form>

          <!-- Transactions Section -->
    

      <!-- Shop List Table -->
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-semibold text-gray-700">Existing Shops</h3>
        <div class="flex gap-2">
            <select id="shop-sort-dropdown" class="border rounded px-2 py-1 text-sm">
                <option value="name">Name</option>
                <option value="id">ID</option>
            </select>
            <select id="shop-sort-order" class="border rounded px-2 py-1 text-sm">
                <option value="asc">Ascending</option>
                <option value="desc">Descending</option>
            </select>
        </div>
      </div>
      <div class="overflow-x-auto">
        <table class="w-full text-left text-sm">
          <thead>
            <tr class="bg-gray-200 w-full">
              <th class="p-2">Name</th>
              <th class="p-2">Location</th>
              <th class="p-2">ID</th>
              <th class="p-2">Actions</th>
            </tr>
          </thead>
          <tbody id="branches-table-body">
            <!-- Shop rows will be inserted here -->
          </tbody>
        </table>
      </div>
    </section>

    <section id="clients-section">
      <h2 class="text-2xl font-semibold text-gray-800 mb-4 flex items-center"><i class="ri-user-3-line mr-2"></i> Client Management</h2>

      <!-- Add Client Form -->
      <form id="client-form-actual" class="grid grid-cols-1 md:grid-cols-3 gap-4 bg-gray-50 p-4 rounded-lg shadow-inner mb-6">
        <div>
          <label for="client-branch" class="block text-sm font-medium text-gray-700">Assign to Shop</label>
          <select id="client-branch" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2">
            <!-- Options populated by JS -->
          </select>
        </div>
        <div>
          <label for="client-name" class="block text-sm font-medium text-gray-700">Client Name</label>
          <input type="text" id="client-name" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2">
        </div>
        <div>
          <label for="client-phone" class="block text-sm font-medium text-gray-700">Phone Number</label>
          <input type="text" id="client-phone" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2">
        </div>
        <div class="col-span-full text-right">
          <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            Add Client
          </button>
        </div>
      </form>
      <!-- Debug Panel for Raw Clients Data -->
      <div id="debug-panel" style="background:#f3f4f6; color:#222; font-size:0.95em; padding:1em; margin:1em 0; border-radius:8px; border:1px solid #ddd; max-height:200px; overflow:auto;">
        <strong>Debug: Raw Clients Data</strong>
        <pre id="debug-raw-clients" style="white-space:pre-wrap; word-break:break-all; margin:0;"></pre>
      </div>
    </section>
    <section id="excel-import-section" class="bg-white rounded-lg shadow-md p-6 mb-6">
        <h2 class="text-2xl font-semibold text-gray-800 mb-4 flex items-center"><i class="ri-file-upload-line mr-2"></i> Import Clients from Excel</h2>
        <div class="bg-gray-50 p-4 rounded-lg shadow-inner mb-4">
            <p class="text-sm text-gray-600 mb-3">
                Upload an Excel file (.xlsx, .xls, .csv) containing client data. The sheet should have columns for "Client Name", "Phone Number", and "Shop ID".
            </p>
            <div class="flex items-center space-x-4">
                <input type="file" id="client-import-file" accept=".xlsx,.xls,.csv" class="block w-full text-sm text-gray-500
                    file:mr-4 file:py-2 file:px-4
                    file:rounded-md file:border-0
                    file:text-sm file:font-semibold
                    file:bg-indigo-50 file:text-indigo-700
                    hover:file:bg-indigo-100"/>
                <button id="import-clients-btn" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    <i class="ri-upload-line mr-2"></i> Import Clients
                </button>
            </div>
            <div id="import-status-message" class="mt-3 text-sm font-medium"></div>
            <div id="import-loading-spinner" class="hidden mt-3 text-center">
                <div class="w-8 h-8 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mx-auto"></div>
                <p class="text-indigo-600 mt-2">Importing clients...</p>
    </div>
    </div>
    </section>

    <section id="transactions-section" class="bg-white rounded-lg shadow-md p-6 mb-6">
      <h2 class="text-2xl font-semibold text-gray-800 mb-4 flex items-center"><i class="ri-file-list-3-line mr-2"></i> All Transactions</h2>
      <div class="flex justify-between items-center mb-4">
        <input type="text" id="transaction-search-input" placeholder="Search transactions..." class="border rounded px-3 py-1 text-sm w-1/3">
        <div class="flex gap-2">
          <select id="transaction-sort-dropdown" class="border rounded px-2 py-1 text-sm">
            <option value="date">Date</option>
            <option value="alpha">Client Name</option>
            <option value="shop">Shop</option>
          </select>
          <select id="transaction-sort-order" class="border rounded px-2 py-1 text-sm">
            <option value="desc" selected>Descending</option>
            <option value="asc">Ascending</option>
          </select>
        </div>
      </div>
      <div class="overflow-x-auto">
        <table class="w-full text-left text-sm">
          <thead>
            <tr class="bg-gray-200 w-full">
              <th class="p-2 min-w-[150px]">Shop Name</th>
              <th class="p-2 min-w-[150px]">Client</th>
              <th class="p-2 min-w-[120px]">Phone</th>
              <th class="p-2 min-w-[150px]">Item</th>
              <th class="p-2 min-w-[100px]">Variant/Type</th>
              <th class="p-2 min-w-[100px]">Units</th>
              <th class="p-2 min-w-[100px]">Money</th>
              <th class="p-2 min-w-[180px]">Date</th>
              <th class="p-2 min-w-[200px]">Product Invoice</th>
              <th class="p-2 min-w-[200px]">Product Purchased Invoice</th>
              <th class="p-2 min-w-[120px]">Invoice No.</th>
              <th class="p-2 min-w-[200px]">Comment</th>
              <th class="p-2 min-w-[80px]">Actions</th>
            </tr>
          </thead>
          <tbody id="transactions-table-body">
            <!-- Transaction rows will be inserted here -->
          </tbody>
        </table>
      </div>
    </section>

    <section id="excel-export-section" class="bg-white rounded-lg shadow-md p-8 mb-6">
      <h2 class="text-2xl font-semibold text-gray-800 mb-4 flex items-center"><i class="ri-file-excel-2-line mr-2"></i> Export Transactions to Excel</h2>
      <div class="bg-gray-50 p-4 rounded-lg shadow-inner mb-4">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
          <div>
            <label for="excel-branch-filter" class="block text-sm font-medium text-gray-700">Filter by Shop:</label>
            <select id="excel-branch-filter" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
              <!-- Options populated by JS -->
            </select>
          </div>
          <div>
            <label for="excel-date-from" class="block text-sm font-medium text-gray-700">Date From:</label>
            <input type="date" id="excel-date-from" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
          </div>
          <div>
            <label for="excel-date-to" class="block text-sm font-medium text-gray-700">Date To:</label>
            <input type="date" id="excel-date-to" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
          </div>
          <div>
            <label for="excel-client-filter" class="block text-sm font-medium text-gray-700">Filter by Client:</label>
            <input type="text" id="excel-client-filter" placeholder="Client Name or Phone" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
          </div>
        </div>
        <div class="mb-4">
          <h4 class="text-md font-medium text-gray-700 mb-2 flex items-center">Select Columns to Export:
            <span class="ml-2 text-gray-400 text-xs" title="Choose which columns appear in the Excel file."><i class="ri-information-line"></i></span>
          </h4>
          <div class="flex flex-wrap gap-x-4 gap-y-2">
            <label class="inline-flex items-center">
              <input type="checkbox" name="excel-columns" value="shopName" checked class="form-checkbox">
              <span class="ml-2 text-sm text-gray-700">Shop Name</span>
            </label>
            <label class="inline-flex items-center">
              <input type="checkbox" name="excel-columns" value="clientName" checked class="form-checkbox">
              <span class="ml-2 text-sm text-gray-700">Client</span>
            </label>
            <label class="inline-flex items-center">
              <input type="checkbox" name="excel-columns" value="phoneNumber" checked class="form-checkbox">
              <span class="ml-2 text-sm text-gray-700">Phone</span>
            </label>
            <label class="inline-flex items-center">
              <input type="checkbox" name="excel-columns" value="purchasedItem" checked class="form-checkbox">
              <span class="ml-2 text-sm text-gray-700">Item</span>
            </label>
            <label class="inline-flex items-center">
              <input type="checkbox" name="excel-columns" value="variant/type" checked class="form-checkbox">
              <span class="ml-2 text-sm text-gray-700">Variant/Type</span>
            </label>
            <label class="inline-flex items-center">
              <input type="checkbox" name="excel-columns" value="units" checked class="form-checkbox">
              <span class="ml-2 text-sm text-gray-700">Units</span>
            </label>
            <label class="inline-flex items-center">
              <input type="checkbox" name="excel-columns" value="money" checked class="form-checkbox">
              <span class="ml-2 text-sm text-gray-700">Money</span>
            </label>
            <label class="inline-flex items-center">
              <input type="checkbox" name="excel-columns" value="dateTime" checked class="form-checkbox">
              <span class="ml-2 text-sm text-gray-700">Date</span>
            </label>
            <label class="inline-flex items-center">
              <input type="checkbox" name="excel-columns" value="invoiceFileName" checked class="form-checkbox">
              <span class="ml-2 text-sm text-gray-700">Product Invoice File Name</span>
            </label>
            <label class="inline-flex items-center">
              <input type="checkbox" name="excel-columns" value="purchasedInvoiceFileName" checked class="form-checkbox">
              <span class="ml-2 text-sm text-gray-700">Product Purchased Invoice File Name</span>
            </label>
            <label class="inline-flex items-center">
              <input type="checkbox" name="excel-columns" value="invoiceNumber" checked class="form-checkbox">
              <span class="ml-2 text-sm text-gray-700">Invoice No.</span>
            </label>
            <label class="inline-flex items-center">
              <input type="checkbox" name="excel-columns" value="comment" checked class="form-checkbox">
              <span class="ml-2 text-sm text-gray-700">Comment</span>
            </label>
          </div>
        </div>
        <div class="flex flex-col md:flex-row gap-4 items-center mb-2">
          <button id="preview-export-btn" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
            <i class="ri-eye-line mr-2"></i> Preview Export (<span id="preview-count">0</span> rows)
          </button>
          <button id="download-excel-btn" disabled class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-gray-700 bg-gray-200 cursor-not-allowed">
            <i class="ri-download-2-line mr-2"></i> Download Export
          </button>
          <button id="clear-filters-btn" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            <i class="ri-eraser-line mr-2"></i> Clear Filters
          </button>
        </div>
        <div class="text-xs text-gray-500 mt-2 mb-2 flex items-center"><i class="ri-information-line mr-1"></i> Each product in a transaction will be exported as a separate row in Excel for clarity.</div>
        <div id="export-preview" class="hidden mt-6 bg-gray-50 p-4 rounded-lg shadow-inner overflow-x-auto">
          <h3 class="text-lg font-semibold mb-2">Export Preview (First 10 Rows)</h3>
          <div class="overflow-x-auto">
            <table class="w-full divide-y divide-gray-200 text-sm">
              <thead>
                <tr id="preview-header" class="bg-gray-100 w-full">
                  <!-- Headers will be dynamically inserted here -->
                </tr>
              </thead>
              <tbody id="preview-body" class="bg-white divide-y divide-gray-200">
                <!-- Preview rows will be dynamically inserted here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>



    <!-- Users Section -->
    <section id="users-section" class="bg-white rounded-lg shadow-md p-6 mb-6">
      <h2 class="text-2xl font-semibold text-gray-800 mb-4 flex items-center"><i class="ri-group-line mr-2"></i> User Accounts</h2>
      <!-- Create User Form (NEW) -->
      <form id="create-user-form" class="grid grid-cols-1 md:grid-cols-3 gap-4 bg-gray-50 p-4 rounded-lg shadow-inner mb-6">
        <div>
          <label for="new-username" class="block text-sm font-medium text-gray-700">Username</label>
          <input type="text" id="new-username" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2">
        </div>
        <div>
          <label for="new-password" class="block text-sm font-medium text-gray-700">Password</label>
          <input type="password" id="new-password" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2">
        </div>
        <div>
          <label for="new-role" class="block text-sm font-medium text-gray-700">Role</label>
          <select id="new-role" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm p-2">
            <option value="superadmin">Grandadmin</option>
            <option value="master-admin">Admin</option>
          </select>
        </div>
        <div class="col-span-full text-right mt-2">
          <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            Create User
          </button>
        </div>
        <div class="col-span-full">
          <p id="create-user-status" class="text-sm mt-2"></p>
        </div>
      </form>
      <!-- End Create User Form -->
      <div class="flex justify-end items-center mb-4">
        <div class="flex gap-2">
        <select id="user-sort-dropdown" class="border rounded px-2 py-1 text-sm">
          <option value="username">Username</option>
            <option value="role">Role</option>
          <option value="shop">Shop</option>
            <option value="createdAt">Created Date</option>
        </select>
        <select id="user-sort-order" class="border rounded px-2 py-1 text-sm">
          <option value="asc">Ascending</option>
          <option value="desc">Descending</option>
        </select>
        </div>
      </div>
      <div class="overflow-x-auto">
        <table class="w-full text-left text-sm">
          <thead>
            <tr class="bg-gray-200 w-full">
              <th class="p-2">Username</th>
              <th class="p-2">Role</th>
              <th class="p-2">Shop</th>
              <th class="p-2">Password</th>
              <th class="p-2">Created At</th>
              <th class="p-2">Actions</th>
            </tr>
          </thead>
          <tbody id="users-table-body"></tbody>
        </table>
      </div>
    </section>

    <!-- Clients Section -->
    <section id="clients-section" class="bg-white rounded-lg shadow-md p-6 mb-6">
      

      <!-- Client List Table -->
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-semibold text-gray-700">Existing Clients</h3>
        <div class="flex gap-2">
        <select id="client-sort-dropdown" class="border rounded px-2 py-1 text-sm">
                <option value="name">Name</option>
          <option value="phone">Phone</option>
          <option value="shop">Shop</option>
        </select>
            <select id="client-sort-order" class="border rounded px-2 py-1 text-sm">
          <option value="asc">Ascending</option>
          <option value="desc">Descending</option>
        </select>
        </div>
      </div>
      <div class="overflow-x-auto">
        <table class="w-full text-left text-sm">
          <thead>
            <tr class="bg-gray-200 w-full">
              <th class="p-2">Client Name</th>
              <th class="p-2">Phone</th>
              <th class="p-2">Shop</th>
              <th class="p-2">Action</th>
            </tr>
          </thead>
          <tbody id="clients-table-body"></tbody>
        </table>
      </div>
    </section>

    <!-- Excel Export Section -->
    

    <!-- Excel Import Clients Section (NEW) -->
    

    <!-- Archive Section (hidden by default) -->
    <section id="archive-section" class="hidden">
      <h2 class="text-2xl font-bold mb-6 flex items-center gap-2"><i class="ri-archive-line"></i> Archive</h2>
      <!-- Restore Shop Modal -->
      <div id="restore-branch-modal" class="fixed inset-0 z-[9999] bg-black bg-opacity-40 flex items-center justify-center hidden">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full flex flex-col items-center">
          <div class="text-2xl font-bold mb-2 text-indigo-700"><i class="ri-history-line"></i> Restore Shop</div>
          <div class="mb-4 text-gray-700 text-center">
            Users (shop user and admin user) will <b>always</b> be restored.<br/>
            Do you also want to restore clients and purchases?
          </div>
          <div class="flex flex-col gap-3 w-full">
            <button id="restore-branch-with-all" class="w-full bg-green-600 text-white py-2 rounded-lg font-semibold hover:bg-green-700 transition">Restore with clients and purchases</button>
            <button id="restore-branch-only" class="w-full bg-blue-600 text-white py-2 rounded-lg font-semibold hover:bg-blue-700 transition">Restore shop only (no clients or purchases)</button>
            <button id="restore-branch-cancel" class="w-full bg-gray-300 text-gray-800 py-2 rounded-lg font-semibold hover:bg-gray-400 transition">Cancel</button>
          </div>
        </div>
      </div>
      <!-- End Restore Shop Modal -->
      <!-- Delete Shop Modal -->
      <div id="delete-shop-modal" class="fixed inset-0 z-[9999] bg-black bg-opacity-40 flex items-center justify-center hidden">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full flex flex-col items-center">
          <div class="text-2xl font-bold mb-2 text-red-700"><i class="ri-delete-bin-line"></i> Delete Shop</div>
          <div class="mb-4 text-gray-700 text-center">
            Users (shop user and admin user) will <b>always</b> be deleted.<br/>
            Do you also want to delete clients and purchases?
          </div>
          <div class="flex flex-col gap-3 w-full">
            <button id="delete-shop-with-all" class="w-full bg-red-600 text-white py-2 rounded-lg font-semibold hover:bg-red-700 transition">Delete shop, users, clients, and purchases</button>
            <button id="delete-shop-only" class="w-full bg-orange-500 text-white py-2 rounded-lg font-semibold hover:bg-orange-600 transition">Delete shop and users only</button>
            <button id="delete-shop-cancel" class="w-full bg-gray-300 text-gray-800 py-2 rounded-lg font-semibold hover:bg-gray-400 transition">Cancel</button>
          </div>
        </div>
      </div>
      <!-- End Delete Shop Modal -->
      <div class="mb-8">
        <h3 class="text-lg font-semibold mb-2 text-indigo-700">Archived Shops</h3>
        <div class="overflow-x-auto">
          <table class="w-full text-left text-sm whitespace-nowrap border mb-4">
            <thead class="bg-gray-200">
              <tr>
                <th class="p-2">Name</th>
                <th class="p-2">Location</th>
                <th class="p-2">ID</th>
                <th class="p-2">Actions</th>
              </tr>
            </thead>
            <tbody id="archived-branches-table-body"></tbody>
          </table>
        </div>
      </div>
      <div class="mb-8">
        <h3 class="text-lg font-semibold mb-2 text-indigo-700">Archived Users</h3>
        <div class="overflow-x-auto">
          <table class="w-full text-left text-sm whitespace-nowrap border mb-4">
            <thead class="bg-gray-200">
              <tr>
                <th class="p-2">Username</th>
                <th class="p-2">Role</th>
                <th class="p-2">Branch</th>
                <th class="p-2">Actions</th>
              </tr>
            </thead>
            <tbody id="archived-users-table-body"></tbody>
          </table>
        </div>
      </div>
      <div class="mb-8">
        <h3 class="text-lg font-semibold mb-2 text-indigo-700">Archived Clients</h3>
        <div class="overflow-x-auto">
          <table class="w-full text-left text-sm whitespace-nowrap border mb-4">
            <thead class="bg-gray-200">
              <tr>
                <th class="p-2">Name</th>
                <th class="p-2">Phone</th>
                <th class="p-2">Branch</th>
                <th class="p-2">Actions</th>
              </tr>
            </thead>
            <tbody id="archived-clients-table-body"></tbody>
          </table>
        </div>
      </div>
      <div class="mb-8">
        <h3 class="text-lg font-semibold mb-2 text-indigo-700">Archived Purchases</h3>
        <div class="overflow-x-auto">
          <table class="w-full text-left text-sm whitespace-nowrap border mb-4">
            <thead class="bg-gray-200">
              <tr>
                <th class="p-2">Shop</th>
                <th class="p-2">Client</th>
                <th class="p-2">Phone</th>
                <th class="p-2">Item(s)</th>
                <th class="p-2">Date</th>
                <th class="p-2">Actions</th>
              </tr>
            </thead>
            <tbody id="archived-purchases-table-body"></tbody>
          </table>
        </div>
      </div>
    </section>

  </main>

  <!-- Shared Scripts -->
  <script src="/common/data.js"></script>
  <script src="/common/products.js"></script>
  <script src="/common/ui-helpers.js"></script>

  <!-- ────────── Active-link Highlighter (no id/class renames) ────────── -->
  <script>
    (function(){
      const links = document.querySelectorAll("aside nav a");
      const targets = [];

      // build map of hash ► element
      links.forEach(a=>{
        const id = a.getAttribute("href").slice(1);     // remove '#'
        const el = document.getElementById(id);
        if(el){ targets.push({link:a, el}); }; 
      });

      // observe when 40 % of a section is visible
      const observer = new IntersectionObserver(
        entries=>{
          entries.forEach(entry=>{
            if(entry.isIntersecting){
              const id = entry.target.id;
              targets.forEach(t=>t.link.classList.toggle(
                "sidebar-active",
                t.el.id === id)
              );
            }
          });
        },
        {threshold:0.4} // 40 %
      );
      targets.forEach(t=>observer.observe(t.el));

      // init highlight when page first loads (if hash present)
      const initialHash = window.location.hash.slice(1);
      if(initialHash){
        targets.forEach(t=>t.link.classList.toggle(
          "sidebar-active",
          t.el.id === initialHash)
        );
      }
    })();
  </script>

  <script>
    function logout() {
      sessionStorage.removeItem('loggedInUser');
      sessionStorage.setItem('logoutMessage', 'You have been logged out.');
      window.location.href = 'loading.html';
    }
  </script>
  <!-- Manual test button for branch dropdown population -->
  <button onclick="populateAllBranchSelects()" style="position:fixed;top:10px;right:10px;z-index:9999;" class="bg-indigo-600 text-white px-4 py-2 rounded shadow">Test Populate Branch Dropdowns</button>
  <script src="super-admin.js"></script>
  
</body>
</html>

<!-- Notification Modal -->
<div id="notification-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3); z-index:9999; align-items:center; justify-content:center;">
  <div id="notification-modal-content" style="background:#fff; color:#222; padding:2rem 2.5rem; border-radius:12px; box-shadow:0 4px 32px rgba(0,0,0,0.18); min-width:300px; max-width:90vw; text-align:center; font-size:1.1rem;">
    <span id="notification-modal-message"></span>
    <br><br>
    <button onclick="hideNotification()" style="background:#2563eb; color:#fff; border:none; border-radius:6px; padding:0.5rem 1.5rem; font-size:1rem; cursor:pointer;">OK</button>
  </div>
</div>

<!-- Edit Client Modal -->
<div id="edit-client-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(30,30,40,0.35); backdrop-filter:blur(4px); z-index:10000; align-items:center; justify-content:center;">
  <div style="background:#fff; color:#222; padding:2rem 2.5rem; border-radius:16px; box-shadow:0 8px 40px rgba(0,0,0,0.22); min-width:320px; max-width:95vw; text-align:center; font-size:1.1rem;">
    <h2 class="text-xl font-bold mb-4">Edit Client</h2>
    <form id="edit-client-form">
      <input type="hidden" id="edit-client-branch" />
      <input type="hidden" id="edit-client-index" />
      <div class="mb-4">
        <label for="edit-client-name" class="block text-sm font-medium text-gray-700 mb-1">Client Name</label>
        <input type="text" id="edit-client-name" class="w-full border border-gray-300 rounded-md p-2" required />
      </div>
      <div class="mb-4">
        <label for="edit-client-phone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
        <input type="text" id="edit-client-phone" class="w-full border border-gray-300 rounded-md p-2" required />
      </div>
      <div class="flex justify-center gap-4">
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Save</button>
        <button type="button" onclick="hideEditClientModal()" class="bg-gray-300 text-gray-800 px-4 py-2 rounded">Cancel</button>
      </div>
    </form>
  </div>
</div>

<!-- Debug Panel -->
<div id="debug-panel" style="background:#f3f4f6; color:#222; font-size:0.95em; padding:1em; margin:1em 0; border-radius:8px; border:1px solid #ddd; max-height:200px; overflow:auto;">
  <strong>Debug: Raw Clients Data</strong>
  <pre id="debug-raw-clients" style="white-space:pre-wrap; word-break:break-all; margin:0;"></pre>
</div>
